{% extends 'main/base.html' %}
{% load static %}

{% block title %}졸업기준학점조회{% endblock %}

{% block content %}
<div class="grad-credit-wrapper">
  <h3 style="color: #1c2a63; margin-bottom: 30px;">■ 졸업기준학점조회</h3>

  <form id="searchForm" class="query-form">
    <div class="query-btn-top" style="margin-bottom: 15px;">
      <button type="submit">조회</button>
    </div>

    <div class="query-row">
      <div>
        <label>캠퍼스</label>
        <input type="text" value="천안" readonly>
      </div>
      <div>
        <label>구분</label>
        <input type="text" value="학부" readonly>
      </div>
      <div>
        <label>대학</label>
        <input type="text" value="전체" readonly>
      </div>
      <div>
        <label>학부(과)</label>
        <input type="text" name="department" id="department">
      </div>
    </div>
  </form>

  <!-- 테이블 -->
  <div class="table-container">
    <table class="grad-table" border="1" cellpadding="5" cellspacing="0" style="border-collapse: collapse; text-align: center; width: 100%;">
      <thead>
        <tr style="background-color: #ddd;">
          <th rowspan="2">No</th>
          <th rowspan="2">대학</th>
          <th rowspan="2">소속상세명</th>
          <th rowspan="2">입학구분</th>
          <th colspan="3">교양</th>
          <th colspan="3">전공(단일)</th>
          <th colspan="3">다전공</th>
          <th colspan="2">부전공</th>
          <th rowspan="2">잔여학점</th>
          <th rowspan="2">졸업이수</th>
          <th rowspan="2">졸업평점</th>
          <th rowspan="2">조기졸업평점</th>
        </tr>
        <tr style="background-color: #ddd;">
          <th>교필</th><th>교선</th><th>계</th>
          <th>전심</th><th>전선</th><th>계</th>
          <th>전필</th><th>전선</th><th>계</th>
          <th>1전공</th><th>부전공</th>
        </tr>
      </thead>
      <tbody id="resultBody">
        <tr><td colspan="20">조회 결과가 없습니다.</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
  document.getElementById("searchForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const department = document.getElementById("department").value;

    fetch(`/api/graduation/gradCreditCheck?department=${department}`)
      .then(res => res.json())
      .then(data => {
        const tbody = document.getElementById("resultBody");
        tbody.innerHTML = "";

        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="20">조회 결과가 없습니다.</td></tr>`;
          return;
        }

        data.forEach((row, idx) => {
  tbody.innerHTML += `
    <tr>
      <td>${idx + 1}</td>
      <td>${row.college}</td>
      <td>${row.department}</td>
      <td>${row.entry_type}</td>
      <td>${row.lib_req}</td>
      <td>${row.lib_sel}</td>
      <td>${row.lib_total}</td>
      <td>${row.major_core}</td>
      <td>${row.major_sel}</td>
      <td>${row.major_total}</td>
      <td>${row.double_req}</td>
      <td>${row.double_sel}</td>
      <td>${row.double_total}</td>
      <td>${row.sub_major1}</td>
      <td>${row.sub_major2}</td>
      <td>${row.remain_credit}</td>
      <td>${row.grad_avg}</td>
      <td>${row.gpa_grad}</td>
      <td>${row.gpa_early}</td>
    </tr>`;
});
      })
      .catch(err => {
        alert("조회 중 오류가 발생했습니다.");
        console.error(err);
      });
  });
</script>
{% endblock %}
