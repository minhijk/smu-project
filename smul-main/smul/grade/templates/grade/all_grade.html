{% extends 'main/base.html' %}
{% load static %}

{% block title %}전체성적조회{% endblock %}

{% block content %}
<div class="grade-wrapper">

  <!-- 🔹 로그인 사용자 정보 -->
  <div class="student-info">
    <label for="student-id">학번 / 성명 <span class="required">*</span></label>
    <input type="text" id="student-id" value="{{ user.username }}" readonly>
    <input type="text" id="student-name" value="{{ user.get_full_name|default:'성명없음' }}" readonly>
  </div>

  <!-- 🔹 제목 -->
  <h3 class="grade-title">■ 전체성적조회</h3>

  <!-- 🔹 학기별 성적 테이블 -->
  <h4>■ 학기별 성적</h4>
  <table class="grade-table">
    <thead>
      <tr>
        <th>No</th>
        <th>학년도</th>
        <th>학기</th>
        <th>신청학점</th>
        <th>평점계</th>
        <th>평점평균</th>
        <th>백분율</th>
        <th>석차</th>
      </tr>
    </thead>
    <tbody id="grade-table-body">
      <!-- API에서 동적으로 삽입됨 -->
    </tbody>
  </table>
</div>

<script>
fetch('/api/grade/total/')
  .then(response => response.json())
  .then(data => {
    const tbody = document.getElementById("grade-table-body");
    let no = 1;
    data.grades.forEach(g => {
      const row = `
        <tr>
          <td>${no++}</td>
          <td>${g.year}</td>
          <td>${g.semester}</td>
          <td>${g.total_credit}</td>
          <td>${parseFloat(g.grade_point).toFixed(2)}</td>
          <td>${parseFloat(g.grade_average).toFixed(2)}</td>
          <td>${parseFloat(g.percentile).toFixed(2)}</td>
          <td>${g.rank}</td>
        </tr>`;
      tbody.innerHTML += row;
    });
  });
</script>
{% endblock %}
