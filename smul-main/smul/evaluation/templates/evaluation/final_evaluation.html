{% extends 'main/base.html' %}
{% block content %}

<h3 style="color: #1c2a63;">■ 수강과목 목록</h3>

<!-- 🔹 상단 고정 영역 (학번 / 성명만 표시) -->
<div class="student-info">
  <label for="student-id">학번 / 성명 <span class="required">*</span></label>
  <input type="text" id="student-id" value="{{ user.username }}" readonly>
  <input type="text" id="student-name" value="{{ user.get_full_name|default:'성명없음' }}" readonly>
</div>

<!-- 🔹 강의 목록 테이블 -->
<table class="enrollment-table">
  <thead>
    <tr>
      <th>No</th>
      <th>기말강의평가</th>
      <th>학수번호-분반</th>
      <th>교과목명</th>
      <th>담당교수</th>
      <th>학점</th>
    </tr>
  </thead>
  <tbody id="lecture-body">
    <!-- JS로 동적 삽입 -->
  </tbody>
</table>

<!-- 🔻 안내사항 -->
<h3 style="color: #1c2a63; margin-top: 30px;">■ 기말강의평가</h3>
<div style="color: #0051c7; font-size: 13px;">
  ※ 이 수업과 관련하여 다음 문항에 답해주시기 바랍니다.
</div>
<div style="margin-top: 10px; padding: 10px; background-color: #fff0f0; border: 1px solid #ff9999; font-size: 13px; color: red;">
  <strong>&lt;강의평가 안내사항&gt;</strong><br>
  1. 강의평가는 철저히 익명으로 보장되며, 평가 결과는 수업 개선에만 활용됩니다.<br>
  2. 교수에 대한 욕설, 비방 등은 절대 금지됩니다.<br><br>
  본인은 위 내용을 충분히 숙지하였으며, 이에 동의합니다.
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const studentId = document.getElementById("student-id").value;
  const semester = "2025-2";  // 고정
  const evalType = "final";

  fetch(`/api/evaluation/lecSearch?id=${studentId}&semester=${semester}&eval_type=${evalType}`)
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("lecture-body");
      tbody.innerHTML = "";

      data.lectures.forEach((lec, index) => {
        const row = `
          <tr>
            <td>${index + 1}</td>
            <td>
              ${lec.is_submitted
                ? '<span style="color: gray;">평가완료</span>'
                : `<a href="/evaluation/final/${lec.id}/">
                    <button style="background-color: #1f75cb; color: white;">강의평가</button>
                   </a>`
              }
            </td>
            <td>${lec.course_code}</td>
            <td>${lec.course_name}</td>
            <td>${lec.professor}</td>
            <td>${lec.credit}</td>
          </tr>
        `;
        tbody.insertAdjacentHTML("beforeend", row);
      });
    })
    .catch(err => {
      alert("강의 목록을 불러오는 데 실패했습니다.");
    });
});
</script>

{% endblock %}
