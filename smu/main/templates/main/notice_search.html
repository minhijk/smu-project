{% extends "main/base.html" %}

{% block title %}검색 결과: "{{ query }}"{% endblock %}

{% block content %}
<h2>검색 결과: {{ query }}</h2>

<form action="/notice/search" method="get" style="margin-top: 30px;">
    <div style="display: flex; margin: 20px 0;">
        <input type="text" name="search" value="{{ query }}" placeholder="검색" style="flex: 1; padding: 10px; border: 1px solid #ccc; background: white; color: #333;">
        <button style="background: #99aaff; border: none; padding: 10px 20px; cursor: pointer;">검색</button>
    </div>
</form>

<!-- 카테고리 탭 -->
<ul class="tabs" style="display: flex; gap: 10px; margin: 20px 0; padding: 0; list-style: none;">
  <li class="active"><a href="#" onclick="loadNotices('all', this); return false;">상명</a></li>
  <li><a href="#" onclick="loadNotices('seoul', this); return false;">서울</a></li>
  <li><a href="#" onclick="loadNotices('cheonan', this); return false;">천안</a></li>
  <li><a href="#" onclick="loadNotices('employment', this); return false;">채용</a></li>
</ul>

<!-- 공지사항 리스트 영역 -->
<ul id="notice-list" style="list-style: none; padding: 0;">
  {% if results %}
    {% for notice in results %}
    <li style="padding: 12px 0; border-bottom: 1px solid #333;">
      <a href="/notice?id={{ notice.id }}" style="text-decoration: none; color: black; font-size: 1.1em;">
        {{ notice.title }}
      </a>
      <div style="font-size: 0.9em; color: #555; margin-top: 4px;">
        작성자: {{ notice.author }} | 작성일: {{ notice.created_at|date:"Y-m-d" }}
      </div>
    </li>
    {% endfor %}
  {% else %}
    <p style="color: gray;">검색 결과가 없습니다.</p>
  {% endif %}
</ul>

<script>
function loadNotices(category, tabElement) {
  // 탭 UI 변경
  document.querySelectorAll('.tabs li').forEach(li => li.classList.remove('active'));
  tabElement.parentElement.classList.add('active');

  // AJAX로 카테고리별 공지사항 요청 (JSON 반환 예상)
  fetch(`/notice/search?q=${encodeURIComponent(category)}`)
    .then(response => response.json())
    .then(data => {
      const list = document.getElementById('notice-list');
      list.innerHTML = '';

      if (data.length === 0) {
        list.innerHTML = '<li>공지사항이 없습니다.</li>';
        return;
      }

      data.forEach(notice => {
        const li = document.createElement('li');
        li.style.padding = '12px 0';
        li.style.borderBottom = '1px solid #333';
        li.innerHTML = `
          <a href="/notice?id=${notice.id}" style="text-decoration: none; color: black; font-size: 1.1em;">
            ${notice.title}
          </a>
          <div style="font-size: 0.9em; color: #555; margin-top: 4px;">
            작성자: ${notice.author} | 작성일: ${notice.created_at}
          </div>
        `;
        list.appendChild(li);
      });
    })
    .catch(error => {
      console.error('공지사항 로딩 중 오류 발생:', error);
    });
}
</script>

{% endblock %}
